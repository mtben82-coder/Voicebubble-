import fs from "fs";
import path from "path";

const promptsDir = path.join(process.cwd(), "prompts");

// Load Smart Engine (plain text)
export const SMART_ENGINE = fs.readFileSync(
  path.join(promptsDir, "smartEngine.txt"),
  "utf8"
);

// Load preset configs
export const PRESET_CONFIGS = JSON.parse(
  fs.readFileSync(path.join(promptsDir, "presets.json"), "utf8")
);

export function getPresetConfig(presetId) {
  return PRESET_CONFIGS[presetId] || PRESET_CONFIGS["magic"];
}

export function buildMessages(presetId, userText) {
  const config = getPresetConfig(presetId);

  const messages = [
    {
      role: "system",
      content:
        SMART_ENGINE +
        "\n\n" +
        config.systemPrompt +
        "\n\n" +
        (config.constraints || "")
    }
  ];

  if (config.examples) {
    config.examples.forEach((ex) => {
      messages.push({ role: "user", content: ex.input });
      messages.push({ role: "assistant", content: ex.output });
    });
  }

  messages.push({ role: "user", content: userText });

  return messages;
}

export function getPresetParameters(presetId) {
  const config = getPresetConfig(presetId);

  return {
    temperature: config.temperature || 0.7,
    max_tokens: config.maxTokens || 500
  };
}
